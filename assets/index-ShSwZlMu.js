import{r as h,j as e,d as U,f as z,g as _,e as q,h as ee}from"./tanstack-Cntz44Eb.js";import{c as I,a as H,R as Y}from"./index-CX6B4vug.js";import"./react-Cgg2GOmP.js";const B=[{id:"bad-dreams-cruller",name:"ナイトメアクルーラー",flavors:{sweet:310,spicy:100,sour:310,bitter:40,fresh:40}},{id:"omega-old-fashioned-donut",name:"オールドファッションオメガ",flavors:{sweet:260,spicy:160,sour:160,bitter:20,fresh:260}},{id:"alpha-old-fashioned-donut",name:"オールドファッションアルファ",flavors:{sweet:50,spicy:50,sour:210,bitter:180,fresh:370}},{id:"delta-old-fashioned-donut",name:"オールドファッションデルタ",flavors:{sweet:120,spicy:40,sour:340,bitter:40,fresh:390}},{id:"plasma-glazed-donut",name:"プラズマディップ",flavors:{sweet:40,spicy:200,sour:400,bitter:280,fresh:40}}],re=[{id:"cheri-berry",name:"クラボのみ",level:1,calories:60,flavors:{sweet:0,spicy:10,sour:0,bitter:0,fresh:0},hyper:!1},{id:"chesto-berry",name:"カゴのみ",level:1,calories:60,flavors:{sweet:0,spicy:0,sour:0,bitter:0,fresh:10},hyper:!1},{id:"pecha-berry",name:"モモンのみ",level:1,calories:60,flavors:{sweet:10,spicy:0,sour:0,bitter:0,fresh:0},hyper:!1},{id:"rawst-berry",name:"チーゴのみ",level:1,calories:60,flavors:{sweet:0,spicy:0,sour:0,bitter:10,fresh:0},hyper:!1},{id:"aspear-berry",name:"ナナシのみ",level:1,calories:60,flavors:{sweet:0,spicy:0,sour:10,bitter:0,fresh:0},hyper:!1},{id:"oran-berry",name:"オレンのみ",level:1,calories:60,flavors:{sweet:0,spicy:5,sour:5,bitter:5,fresh:5},hyper:!1},{id:"persim-berry",name:"キーのみ",level:1,calories:60,flavors:{sweet:5,spicy:5,sour:5,bitter:0,fresh:5},hyper:!1},{id:"lum-berry",name:"ラムのみ",level:2,calories:65,flavors:{sweet:5,spicy:5,sour:0,bitter:5,fresh:5},hyper:!1},{id:"sitrus-berry",name:"オボンのみ",level:2,calories:65,flavors:{sweet:5,spicy:0,sour:5,bitter:5,fresh:5},hyper:!1},{id:"pomeg-berry",name:"ザロクのみ",level:2,calories:65,flavors:{sweet:10,spicy:10,sour:0,bitter:10,fresh:0},hyper:!1},{id:"kelpsy-berry",name:"ネコブのみ",level:2,calories:65,flavors:{sweet:0,spicy:0,sour:10,bitter:10,fresh:10},hyper:!1},{id:"qualot-berry",name:"タポルのみ",level:2,calories:65,flavors:{sweet:10,spicy:10,sour:10,bitter:0,fresh:0},hyper:!1},{id:"hondew-berry",name:"ロメのみ",level:2,calories:65,flavors:{sweet:0,spicy:10,sour:0,bitter:10,fresh:10},hyper:!1},{id:"grepa-berry",name:"ウブのみ",level:2,calories:65,flavors:{sweet:10,spicy:0,sour:10,bitter:0,fresh:10},hyper:!1},{id:"tomato-berry",name:"マトマのみ",level:2,calories:65,flavors:{sweet:0,spicy:15,sour:0,bitter:0,fresh:10},hyper:!1},{id:"occa-berry",name:"オッカのみ",level:3,calories:70,flavors:{sweet:10,spicy:15,sour:0,bitter:0,fresh:0},hyper:!1},{id:"passho-berry",name:"イトケのみ",level:3,calories:70,flavors:{sweet:0,spicy:0,sour:0,bitter:10,fresh:15},hyper:!1},{id:"wacan-berry",name:"ソクノのみ",level:3,calories:70,flavors:{sweet:15,spicy:0,sour:10,bitter:0,fresh:0},hyper:!1},{id:"rindo-berry",name:"リンドのみ",level:3,calories:70,flavors:{sweet:0,spicy:10,sour:0,bitter:15,fresh:0},hyper:!1},{id:"yache-berry",name:"ヤチェのみ",level:3,calories:70,flavors:{sweet:0,spicy:0,sour:15,bitter:0,fresh:10},hyper:!1},{id:"chople-berry",name:"ヨプのみ",level:3,calories:70,flavors:{sweet:0,spicy:15,sour:0,bitter:10,fresh:0},hyper:!1},{id:"kebia-berry",name:"ビアーのみ",level:3,calories:70,flavors:{sweet:0,spicy:0,sour:10,bitter:0,fresh:15},hyper:!1},{id:"shuca-berry",name:"シュカのみ",level:3,calories:70,flavors:{sweet:15,spicy:10,sour:0,bitter:0,fresh:0},hyper:!1},{id:"coba-berry",name:"バコウのみ",level:3,calories:70,flavors:{sweet:0,spicy:0,sour:0,bitter:15,fresh:10},hyper:!1},{id:"payapa-berry",name:"ウタンのみ",level:3,calories:70,flavors:{sweet:10,spicy:0,sour:15,bitter:0,fresh:0},hyper:!1},{id:"tanga-berry",name:"タンガのみ",level:3,calories:70,flavors:{sweet:0,spicy:20,sour:10,bitter:0,fresh:0},hyper:!1},{id:"charti-berry",name:"ヨロギのみ",level:3,calories:70,flavors:{sweet:0,spicy:10,sour:0,bitter:0,fresh:20},hyper:!1},{id:"kasib-berry",name:"カシブのみ",level:3,calories:70,flavors:{sweet:20,spicy:0,sour:0,bitter:0,fresh:10},hyper:!1},{id:"haban-berry",name:"ハバンのみ",level:3,calories:70,flavors:{sweet:10,spicy:0,sour:0,bitter:20,fresh:0},hyper:!1},{id:"colbur-berry",name:"ナモのみ",level:3,calories:70,flavors:{sweet:0,spicy:0,sour:20,bitter:10,fresh:0},hyper:!1},{id:"babiri-berry",name:"リリバのみ",level:3,calories:70,flavors:{sweet:0,spicy:25,sour:0,bitter:0,fresh:10},hyper:!1},{id:"chilan-berry",name:"ホズのみ",level:3,calories:70,flavors:{sweet:10,spicy:0,sour:0,bitter:0,fresh:25},hyper:!1},{id:"roseli-berry",name:"ロゼルのみ",level:3,calories:70,flavors:{sweet:25,spicy:0,sour:0,bitter:10,fresh:0},hyper:!1},{id:"hyper-cheri-berry",name:"いじげんクラボのみ",level:5,calories:80,flavors:{sweet:0,spicy:40,sour:0,bitter:0,fresh:0},hyper:!0},{id:"hyper-chesto-berry",name:"いじげんカゴのみ",level:3,calories:100,flavors:{sweet:0,spicy:0,sour:0,bitter:0,fresh:40},hyper:!0},{id:"hyper-pecha-berry",name:"いじげんモモンのみ",level:2,calories:100,flavors:{sweet:40,spicy:0,sour:0,bitter:0,fresh:0},hyper:!0},{id:"hyper-rawst-berry",name:"いじげんチーゴのみ",level:3,calories:110,flavors:{sweet:0,spicy:0,sour:0,bitter:40,fresh:0},hyper:!0},{id:"hyper-aspear-berry",name:"いじげんナナシのみ",level:4,calories:90,flavors:{sweet:0,spicy:0,sour:40,bitter:0,fresh:0},hyper:!0},{id:"hyper-oran-berry",name:"いじげんオレンのみ",level:6,calories:90,flavors:{sweet:10,spicy:20,sour:15,bitter:15,fresh:0},hyper:!0},{id:"hyper-persim-berry",name:"いじげんキーのみ",level:4,calories:110,flavors:{sweet:0,spicy:15,sour:15,bitter:10,fresh:20},hyper:!0},{id:"hyper-lum-berry",name:"いじげんラムのみ",level:3,calories:110,flavors:{sweet:20,spicy:15,sour:10,bitter:0,fresh:15},hyper:!0},{id:"hyper-sitrus-berry",name:"いじげんオボンのみ",level:4,calories:120,flavors:{sweet:15,spicy:10,sour:0,bitter:20,fresh:15},hyper:!0},{id:"hyper-pomeg-berry",name:"いじげんザロクのみ",level:7,calories:140,flavors:{sweet:30,spicy:35,sour:0,bitter:0,fresh:5},hyper:!0},{id:"hyper-kelpsy-berry",name:"いじげんネコブのみ",level:5,calories:160,flavors:{sweet:5,spicy:0,sour:0,bitter:30,fresh:35},hyper:!0},{id:"hyper-qualot-berry",name:"いじげんタポルのみ",level:4,calories:160,flavors:{sweet:35,spicy:0,sour:30,bitter:5,fresh:0},hyper:!0},{id:"hyper-hondew-berry",name:"いじげんロメのみ",level:6,calories:150,flavors:{sweet:0,spicy:5,sour:35,bitter:0,fresh:30},hyper:!0},{id:"hyper-grepa-berry",name:"いじげんウブのみ",level:8,calories:140,flavors:{sweet:0,spicy:60,sour:25,bitter:0,fresh:5},hyper:!0},{id:"hyper-tomato-berry",name:"いじげんマトマのみ",level:6,calories:180,flavors:{sweet:0,spicy:25,sour:0,bitter:0,fresh:60},hyper:!0},{id:"hyper-occa-berry",name:"いじげんオッカのみ",level:5,calories:180,flavors:{sweet:60,spicy:0,sour:0,bitter:5,fresh:25},hyper:!0},{id:"hyper-passho-berry",name:"いじげんイトケのみ",level:6,calories:200,flavors:{sweet:25,spicy:0,sour:5,bitter:60,fresh:0},hyper:!0},{id:"hyper-wacan-berry",name:"いじげんソクノのみ",level:7,calories:160,flavors:{sweet:0,spicy:5,sour:60,bitter:25,fresh:0},hyper:!0},{id:"hyper-rindo-berry",name:"いじげんリンドのみ",level:9,calories:210,flavors:{sweet:15,spicy:55,sour:0,bitter:5,fresh:25},hyper:!0},{id:"hyper-yache-berry",name:"いじげんヤチェのみ",level:7,calories:250,flavors:{sweet:25,spicy:0,sour:5,bitter:15,fresh:55},hyper:!0},{id:"hyper-chople-berry",name:"いじげんヨプのみ",level:6,calories:250,flavors:{sweet:55,spicy:5,sour:15,bitter:25,fresh:0},hyper:!0},{id:"hyper-kebia-berry",name:"いじげんビアーのみ",level:7,calories:270,flavors:{sweet:0,spicy:15,sour:25,bitter:55,fresh:5},hyper:!0},{id:"hyper-shuca-berry",name:"いじげんシュカのみ",level:8,calories:230,flavors:{sweet:5,spicy:25,sour:55,bitter:0,fresh:15},hyper:!0},{id:"hyper-coba-berry",name:"いじげんバコウのみ",level:10,calories:240,flavors:{sweet:10,spicy:95,sour:0,bitter:10,fresh:5},hyper:!0},{id:"hyper-payapa-berry",name:"いじげんウタンのみ",level:8,calories:300,flavors:{sweet:5,spicy:0,sour:10,bitter:10,fresh:95},hyper:!0},{id:"hyper-tanga-berry",name:"いじげんタンガのみ",level:7,calories:300,flavors:{sweet:95,spicy:10,sour:10,bitter:5,fresh:0},hyper:!0},{id:"hyper-charti-berry",name:"いじげんヨロギのみ",level:8,calories:330,flavors:{sweet:0,spicy:10,sour:5,bitter:95,fresh:10},hyper:!0},{id:"hyper-kasib-berry",name:"いじげんカシブのみ",level:9,calories:270,flavors:{sweet:10,spicy:5,sour:95,bitter:0,fresh:10},hyper:!0},{id:"hyper-haban-berry",name:"いじげんハバンのみ",level:8,calories:370,flavors:{sweet:85,spicy:0,sour:0,bitter:0,fresh:65},hyper:!0},{id:"hyper-colbur-berry",name:"いじげんナモのみ",level:9,calories:370,flavors:{sweet:0,spicy:0,sour:65,bitter:0,fresh:85},hyper:!0},{id:"hyper-babiri-berry",name:"いじげんリリバのみ",level:9,calories:400,flavors:{sweet:0,spicy:0,sour:65,bitter:85,fresh:0},hyper:!0},{id:"hyper-chilan-berry",name:"いじげんホズのみ",level:9,calories:370,flavors:{sweet:0,spicy:85,sour:0,bitter:65,fresh:0},hyper:!0},{id:"hyper-roseli-berry",name:"いじげんロゼルのみ",level:10,calories:340,flavors:{sweet:0,spicy:65,sour:85,bitter:0,fresh:0},hyper:!0}];function le(r,s){const[t,l]=h.useState(r);return h.useEffect(()=>{const a=setTimeout(()=>{l(r)},s);return()=>{clearTimeout(a)}},[r,s]),t}const K={SELECTED_DONUTS:"pokemon-za-selected-donuts",BERRY_STOCKS:"pokemon-za-berry-stocks",SLOTS:"pokemon-za-slots"},F={SLOTS:8,MAX_SOLUTIONS:1e4,DEBOUNCE_DELAY:300,TOAST_DURATION:5e3};function G(r){return r.replace(/[\u30A1-\u30F6]/g,t=>{const l=t.charCodeAt(0)-96;return String.fromCharCode(l)}).toLowerCase()}function ae({hyperFilter:r,searchText:s,setHyperFilter:t,setSearchText:l}){const a=le(s,F.DEBOUNCE_DELAY);return{filteredBerries:h.useMemo(()=>re.filter(i=>{if(r!=="all"&&i.hyper!==(r==="true"))return!1;if(a){const n=G(a),c=G(i.name),d=i.id.toLowerCase();return c.includes(n)||d.includes(n)}return!0}),[r,a]),hyperFilter:r,setHyperFilter:t,searchText:s,setSearchText:l}}const O=I("PersistedState");function W(r,s,t=JSON.stringify,l=JSON.parse){const[a,o]=h.useState(()=>{try{const n=window.localStorage.getItem(r);return n?l(n):s}catch(n){return O.warn(`Error loading "${r}" from localStorage:`,n),s}});h.useEffect(()=>{try{window.localStorage.setItem(r,t(a))}catch(n){O.warn(`Error saving "${r}" to localStorage:`,n)}},[r,a,t]);const i=h.useCallback(()=>{o(s);try{window.localStorage.removeItem(r)}catch(n){O.warn(`Error removing "${r}" from localStorage:`,n)}},[r,s]);return[a,o,i]}function ne(){const[r,s,t]=W(K.BERRY_STOCKS,{}),l=h.useCallback((o,i)=>{s(n=>({...n,[o]:Math.max(0,i)}))},[s]),a=h.useCallback(()=>{t()},[t]);return{berryStocks:r,handleStockChange:l,handleResetStocks:a}}function oe(r){return JSON.stringify(Array.from(r))}function ie(r){try{const s=JSON.parse(r);return new Set(s)}catch{return new Set}}function ce(r,s){const[t,l]=W(K.SELECTED_DONUTS,new Set,oe,ie),[a,o]=W(K.SLOTS,F.SLOTS);h.useEffect(()=>{r!==void 0&&r!==a&&o(r)},[r,a,o]);const i=h.useCallback(c=>{l(d=>{const f=new Set(d);return f.has(c)?f.delete(c):f.add(c),f})},[l]),n=h.useCallback(c=>{o(c),s?.(c)},[o,s]);return{selectedDonuts:t,handleDonutToggle:i,slots:a,setSlots:n}}function de(r,s,t){const l=[];let a=!1;function o(c,d,f,x){if(l.length>=F.MAX_SOLUTIONS){a=!0;return}if(se(x,r.flavors)){const p=[];for(let b=0;b<s.length;b++)d[b]>0&&p.push({berry:s[b].berry,count:d[b]});l.push({donut:r,stocks:p});return}if(f===0||c>=s.length)return;const y=s[c],N=Math.min(y.count,f);for(let p=0;p<=N;p++){d[c]=p;const b={sweet:x.sweet+y.berry.flavors.sweet*p,spicy:x.spicy+y.berry.flavors.spicy*p,sour:x.sour+y.berry.flavors.sour*p,bitter:x.bitter+y.berry.flavors.bitter*p,fresh:x.fresh+y.berry.flavors.fresh*p};if(!ue(b,r.flavors,f-p,s,c+1)){d[c]=0;continue}o(c+1,d,f-p,b),d[c]=0}}const i=new Array(s.length).fill(0);return o(0,i,t,{sweet:0,spicy:0,sour:0,bitter:0,fresh:0}),{recipes:l,limitReached:a}}function se(r,s){return r.sweet>=s.sweet&&r.spicy>=s.spicy&&r.sour>=s.sour&&r.bitter>=s.bitter&&r.fresh>=s.fresh}function ue(r,s,t,l,a){if(t===0)return se(r,s);const o={...r},i={sweet:0,spicy:0,sour:0,bitter:0,fresh:0};for(let n=a;n<l.length;n++){const c=l[n];if(c.count>0){const d=c.berry.flavors;i.sweet=Math.max(i.sweet,d.sweet),i.spicy=Math.max(i.spicy,d.spicy),i.sour=Math.max(i.sour,d.sour),i.bitter=Math.max(i.bitter,d.bitter),i.fresh=Math.max(i.fresh,d.fresh)}}return o.sweet+=i.sweet*t,o.spicy+=i.spicy*t,o.sour+=i.sour*t,o.bitter+=i.bitter*t,o.fresh+=i.fresh*t,o.sweet>=s.sweet&&o.spicy>=s.spicy&&o.sour>=s.sour&&o.bitter>=s.bitter&&o.fresh>=s.fresh}function J(r){return new Worker("/pokemon-za-donut/assets/finder.worker-Cfz7GARk.js",{name:r?.name})}const $=I("ParallelRecipeFinder");class he{maxWorkers;maxSolutionsPerWorker;constructor(s={}){const t=Math.min(navigator.hardwareConcurrency||4,4);this.maxWorkers=s.maxWorkers||t,this.maxSolutionsPerWorker=s.maxSolutionsPerWorker||1e4,$.log(`Initialized with ${this.maxWorkers} workers`)}async findRecipes(s,t,l){if(t.length===0||l===0)return{recipes:[],limitReached:!1};const a=performance.now(),o=this.generateTasks(s,t,l);if($.log(`Generated ${o.length} tasks`),o.length===1){$.log("Single task, using one worker");const c=await this.runSingleWorker(o[0]),d=performance.now();return $.log(`Completed in ${(d-a).toFixed(2)}ms, found ${c.recipes.length} recipes`),c}const i=await this.runParallel(o),n=performance.now();return $.log(`Completed in ${(n-a).toFixed(2)}ms, found ${i.recipes.length} recipes`),$.log(`Explored ${i.totalExplored} nodes across ${o.length} workers`),{recipes:i.recipes,limitReached:i.limitReached}}generateTasks(s,t,l){const a=[],o=t[0],i=Math.min(o.count,l);for(let n=0;n<=i;n++)a.push({required:s,stocks:t,slots:l,maxSolutions:this.maxSolutionsPerWorker,firstBerryIndex:0,firstBerryCount:n});return a}runSingleWorker(s){return new Promise((t,l)=>{const a=new J;a.onmessage=o=>{t(o.data),a.terminate()},a.onerror=o=>{l(o),a.terminate()},a.postMessage(s)})}async runParallel(s){const t=[];let l=!1,a=0;const o=[];for(let d=0;d<Math.min(this.maxWorkers,s.length);d++)o.push(new J);$.log(`Running ${s.length} tasks on ${o.length} workers`);let i=0;const n=new Map,c=d=>{if(i>=s.length)return null;const f=i++,x=s[f];return new Promise((y,N)=>{const p=g=>{y(g.data),d.removeEventListener("message",p),d.removeEventListener("error",b)},b=g=>{N(g),d.removeEventListener("message",p),d.removeEventListener("error",b)};d.addEventListener("message",p),d.addEventListener("error",b),d.postMessage(x)})};for(const d of o){const f=c(d);f&&n.set(d,f)}for(;n.size>0;){const d=await Promise.race(Array.from(n.entries()).map(async([x,y])=>{const N=await y;return{worker:x,result:N}}));t.push(...d.result.recipes),d.result.limitReached&&(l=!0),a+=d.result.explored,n.delete(d.worker);const f=c(d.worker);f&&n.set(d.worker,f)}for(const d of o)d.terminate();return{recipes:t,limitReached:l,totalExplored:a}}static shouldUseParallel(s,t){return s.length>=3&&t>=4}}const C=I("EnhancedRecipeFinder"),me=15,fe=6;class pe{parallelFinder;constructor(){this.parallelFinder=new he}async findRecipes(s,t,l,a={}){if(this.shouldUseParallel(t,l,a))try{C.log("Using parallel execution with Web Workers");const c=H("Parallel processing"),d=await this.parallelFinder.findRecipes(s,t,l);return c.end(C),C.log(`Found ${d.recipes.length} recipes`),d}catch(c){C.error("Parallel processing failed, falling back to single-threaded:",c);const d=c instanceof Error?c.message:"Unknown error";C.warn(`Error details: ${d}`),C.warn("Fallback: Using single-threaded CPU processing instead")}C.log("Using single-threaded CPU processing");const i=H("CPU processing"),n=de(s,t,l);return i.end(C),C.log(`CPU found ${n.recipes.length} recipes`),n}shouldUseParallel(s,t,l){if(l.forceSingleThread)return!1;if(typeof Worker>"u")return C.log("Web Workers not available"),!1;if(l.forceParallel)return!0;const a=s.length>=me,o=t>=fe;return a&&o}isParallelAvailable(){return typeof Worker<"u"}getPerformanceInfo(){return{parallelAvailable:this.isParallelAvailable(),workerCount:navigator.hardwareConcurrency||4,cpuAvailable:!0}}}function xe(r){return r>=960?5:r>=700?4:r>=350?3:r>=240?2:r>=120?1:0}function ye(r){const s=r.reduce((i,n)=>i+n.berry.calories*n.count,0),t=r.reduce((i,n)=>i+n.berry.level*n.count,0),l=r.reduce((i,n)=>({sweet:i.sweet+n.berry.flavors.sweet*n.count,spicy:i.spicy+n.berry.flavors.spicy*n.count,sour:i.sour+n.berry.flavors.sour*n.count,bitter:i.bitter+n.berry.flavors.bitter*n.count,fresh:i.fresh+n.berry.flavors.fresh*n.count}),{sweet:0,spicy:0,sour:0,bitter:0,fresh:0}),a=l.sweet+l.spicy+l.sour+l.bitter+l.fresh,o=r.reduce((i,n)=>i+n.count,0);return{calories:s,level:t,flavors:l,flavorSum:a,berryCount:o}}function be(r){const s=xe(r.flavorSum),t=1+.1*s;return{stars:s,plusLevel:Math.floor(r.level*t),donutEnergy:Math.floor(r.calories*t)}}function ge(r){return r.map(s=>`${s.berry.name} x${s.count}`).join(", ")}function ve(r,s){const t=B.find(l=>l.id===r);return t?s.map((l,a)=>{const o=ye(l.stocks),i=be(o);return{donutName:t.name,recipeIndex:a+1,berries:ge(l.stocks),berryCount:o.berryCount,totalCalories:o.calories,totalLevel:o.level,sweet:o.flavors.sweet,spicy:o.flavors.spicy,sour:o.flavors.sour,bitter:o.flavors.bitter,fresh:o.flavors.fresh,stars:i.stars,plusLevel:i.plusLevel,donutEnergy:i.donutEnergy}}):[]}function we(r){return Array.from(r.entries()).flatMap(([s,t])=>ve(s,t))}function je(){const r=h.useRef(null);r.current||(r.current=new pe);const s=r.current,t=h.useRef(null),[l,a]=h.useState(new Map),[o,i]=h.useState(!1),[n,c]=h.useState(null),[d,f]=h.useState(null),[x,y]=h.useState(null),N=h.useCallback(async(g,k,R)=>{t.current&&t.current.abort(),t.current=new AbortController;const E=t.current.signal;i(!0),c(null),f(null),y(null);const V=performance.now();try{if(E.aborted)return;const j=re.filter(w=>(k[w.id]||0)>0).map(w=>({berry:w,count:k[w.id]||0}));if(j.length===0)throw new Error(`きのみが選択されていません。

解決方法：
• 「きのみ個数入力」タブで所持しているきのみの個数を1以上に設定してください`);if(g.size===0)throw new Error(`ドーナツが選択されていません。

解決方法：
• 「ドーナツ選択」タブで作りたいドーナツをチェックしてください`);if(R<1||R>20)throw new Error("スロット数は1〜20の範囲で指定してください。");if(Object.values(k).reduce((w,L)=>w+L,0)>9999)throw new Error(`きのみの合計個数が多すぎます（上限: 9999個）。

解決方法：
• 「きのみ個数入力」タブで個数を減らしてください`);g.size>50&&f("50個以上のドーナツが選択されています。処理に時間がかかる場合があります。");const u=new Map,m=[],T=Array.from(g).map(async w=>{if(E.aborted)throw new DOMException("Search cancelled","AbortError");const L=B.find(S=>S.id===w);if(!L)return;const v=await s.findRecipes(L,j,R);if(E.aborted)throw new DOMException("Search cancelled","AbortError");u.set(w,v.recipes),v.limitReached&&m.push(L.name)});if(await Promise.all(T),E.aborted)return;if(m.length>0){const w=m.join("、");f(`${w} のレシピが非常に多く、最初の${F.MAX_SOLUTIONS.toLocaleString()}件のみ表示しています。`)}a(u);const D=performance.now();y((D-V)/1e3)}catch(j){if(j instanceof DOMException&&j.name==="AbortError")return;const M=j instanceof Error?j.message:"レシピの検索中にエラーが発生しました";throw c(M),new Error(M)}finally{i(!1)}},[s]),p=h.useMemo(()=>we(l),[l]),b=h.useCallback(()=>{t.current&&(t.current.abort(),i(!1))},[]);return{recipes:l,recipeRows:p,handleFindRecipes:N,cancelSearch:b,isSearching:o,error:n,clearError:()=>c(null),warning:d,clearWarning:()=>f(null),searchTime:x}}function Ne({activeTab:r,onTabChange:s}){const t=[{value:"donuts",label:"ドーナツ選択"},{value:"berries",label:"きのみ個数入力"},{value:"results",label:"レシピ検索結果"}],l=h.useRef({donuts:null,berries:null,results:null});return h.useEffect(()=>{const a=l.current[r];a&&document.activeElement!==a&&a.focus({preventScroll:!0})},[r]),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsx("div",{className:"flex gap-4",role:"tablist",children:t.map(a=>e.jsx("button",{ref:o=>{l.current[a.value]=o},type:"button",role:"tab","aria-selected":r===a.value,"aria-controls":`${a.value}-panel`,id:`${a.value}-tab`,tabIndex:r===a.value?0:-1,onClick:()=>s(a.value),className:`py-2 px-4 border-b-2 font-medium transition-colors outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-t ${r===a.value?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:a.label},a.value))})})}function Se({title:r,steps:s,variant:t="info"}){const l={info:"bg-blue-50 border-blue-200 text-blue-900",warning:"bg-yellow-50 border-yellow-200 text-yellow-900"},a={info:"text-blue-900",warning:"text-yellow-900"},o={info:"text-blue-800",warning:"text-yellow-800"};return e.jsxs("aside",{className:`${l[t]} border rounded-lg p-4 mb-4`,children:[e.jsxs("h3",{className:`font-semibold ${a[t]} mb-2 flex items-center gap-2`,children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:[e.jsx("title",{children:"情報"}),e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})]}),r]}),e.jsx("ol",{className:`list-decimal list-inside space-y-1 ${o[t]}`,children:s.map(i=>e.jsx("li",{children:i},i))})]})}const X=h.memo(function({donut:s,checked:t,onToggle:l}){return e.jsx("input",{type:"checkbox",checked:t,onChange:()=>l(s.id),className:"w-4 h-4","aria-label":`${s.name}を選択`})});function Ce(r){const[s,t]=h.useState(()=>typeof window>"u"?!1:window.matchMedia(r).matches);return h.useEffect(()=>{const l=window.matchMedia(r),a=o=>{t(o.matches)};return t(l.matches),l.addEventListener("change",a),()=>{l.removeEventListener("change",a)}},[r]),s}const ke={MD:"(min-width: 768px)"};function A(){return!Ce(ke.MD)}function Re({selectedDonuts:r,onDonutToggle:s,slots:t,onSlotsChange:l}){const a=A(),o=h.useMemo(()=>[{id:"select",header:"選択",cell:n=>{const c=n.row.original;return e.jsx(X,{donut:c,checked:r.has(c.id),onToggle:s})}},{accessorKey:"name",header:"ドーナツ名",cell:n=>n.getValue()},{accessorKey:"flavors.sweet",header:"スイート",cell:n=>n.row.original.flavors.sweet},{accessorKey:"flavors.spicy",header:"スパイシー",cell:n=>n.row.original.flavors.spicy},{accessorKey:"flavors.sour",header:"サワー",cell:n=>n.row.original.flavors.sour},{accessorKey:"flavors.bitter",header:"ビター",cell:n=>n.row.original.flavors.bitter},{accessorKey:"flavors.fresh",header:"フレッシュ",cell:n=>n.row.original.flavors.fresh}],[s,r]),i=U({data:B,columns:o,getCoreRowModel:_()});return e.jsxs("section",{className:"space-y-4",role:"tabpanel",id:"donuts-panel","aria-labelledby":"donuts-tab",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"ドーナツ選択"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("label",{className:"font-medium",htmlFor:"slots-input",children:"利用できるきのみ数:"}),e.jsx("input",{id:"slots-input",type:"number",min:"1",value:t,onChange:n=>l(Math.max(1,parseInt(n.target.value,10)||1)),className:"border rounded px-3 py-1 w-24"})]})]}),r.size===0&&e.jsx(Se,{title:"使い方",steps:["作りたいドーナツをチェックボックスで選択してください","「きのみ個数入力」タブで所持しているきのみの個数を入力","右下の検索ボタンをクリックしてレシピを検索"]}),a?e.jsx("div",{className:"space-y-3",children:B.map(n=>{const c=r.has(n.id);return e.jsx("div",{className:`border rounded-lg p-4 transition-all ${c?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"pt-1",children:e.jsx(X,{donut:n,checked:c,onToggle:s})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:n.name}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Sweet:"}),e.jsx("span",{className:"font-medium",children:n.flavors.sweet})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Spicy:"}),e.jsx("span",{className:"font-medium",children:n.flavors.spicy})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Sour:"}),e.jsx("span",{className:"font-medium",children:n.flavors.sour})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bitter:"}),e.jsx("span",{className:"font-medium",children:n.flavors.bitter})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Fresh:"}),e.jsx("span",{className:"font-medium",children:n.flavors.fresh})]})]})]})]})},n.id)})}):e.jsx("div",{className:"overflow-x-auto border rounded",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("caption",{className:"sr-only",children:"ドーナツ選択テーブル"}),e.jsx("thead",{className:"bg-gray-50",children:i.getHeaderGroups().map(n=>e.jsx("tr",{children:n.headers.map(c=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:c.isPlaceholder?null:z(c.column.columnDef.header,c.getContext())},c.id))},n.id))}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.getRowModel().rows.map(n=>e.jsx("tr",{className:"hover:bg-gray-50",children:n.getVisibleCells().map(c=>e.jsx("td",{className:"px-4 py-3 text-sm",children:z(c.column.columnDef.cell,c.getContext())},c.id))},n.id))})]})})]})}const Ee=I("CSV");function Me(r){const s=["berryId,count"];for(const[t,l]of Object.entries(r))l>0&&s.push(`${t},${l}`);return s.join(`
`)}function Te(r){const s={};try{const t=r.trim().split(`
`),l=t[0]?.toLowerCase().includes("berryid")?1:0;for(let a=l;a<t.length;a++){const o=t[a].trim();if(!o)continue;const[i,n]=o.split(",").map(d=>d.trim());if(!i)continue;const c=parseInt(n,10);!Number.isNaN(c)&&c>=0&&(s[i]=c)}}catch(t){Ee.warn("Error parsing CSV:",t)}return s}function Le(r){const s=["ドーナツ,レシピ#,使用きのみ,きのみ個数,星,プラスレベル,ハラモチエネルギー,スイート,スパイシー,サワー,ビター,フレッシュ,合計レベル,合計カロリー"];for(const t of r){const l=[Q(t.donutName),t.recipeIndex,Q(t.berries),t.berryCount,t.stars,t.plusLevel,t.donutEnergy,t.sweet,t.spicy,t.sour,t.bitter,t.fresh,t.totalLevel,t.totalCalories].join(",");s.push(l)}return s.join(`
`)}function Q(r){return r.includes(",")||r.includes(`
`)||r.includes('"')?`"${r.replace(/"/g,'""')}"`:r}function $e(r,s){const t=new Blob([r],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),a=URL.createObjectURL(t);l.setAttribute("href",a),l.setAttribute("download",s),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)}const Ve=h.memo(function({berry:s,value:t,onChange:l}){return e.jsx("input",{type:"number",min:"0",value:t,onChange:a=>l(s.id,parseInt(a.target.value,10)||0),className:"border rounded px-2 py-1 w-20","aria-label":`${s.name}の個数`})});function De({onResetClick:r,resetButtonRef:s}){return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"きのみ個数入力"}),e.jsx("button",{ref:s,type:"button",onClick:r,className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-colors",children:"すべてリセット"})]})}function ze({hyperFilter:r,onHyperFilterChange:s,searchText:t,onSearchTextChange:l}){return e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("label",{className:"font-medium",htmlFor:"hyper-filter",children:"きのみ種別:"}),e.jsxs("select",{id:"hyper-filter",value:r,onChange:a=>s(a.target.value),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"all",children:"すべて"}),e.jsx("option",{value:"true",children:"異次元のみ"}),e.jsx("option",{value:"false",children:"通常のみ"})]})]}),e.jsxs("div",{className:"flex gap-2 items-center flex-1",children:[e.jsx("label",{className:"font-medium",htmlFor:"search-input",children:"Search:"}),e.jsx("input",{id:"search-input",type:"text",value:t,onChange:a=>l(a.target.value),placeholder:"Search by name or ID...",className:"border rounded px-3 py-1 flex-1 max-w-md"})]})]})}function Be({csvText:r,onCsvTextChange:s,onExport:t,onImport:l}){return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{htmlFor:"csv-input",className:"block font-medium",children:"CSV形式でインポート/エクスポート"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:t,className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors text-sm",title:"現在のテーブルの状態をCSVに出力",children:"エクスポート"}),e.jsx("button",{type:"button",onClick:l,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors text-sm",title:"CSVの内容をテーブルに反映",children:"インポート"})]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["形式: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"berryId,count"})]}),e.jsx("textarea",{id:"csv-input",value:r,onChange:a=>s(a.target.value),className:"w-full border rounded px-3 py-2 font-mono text-sm min-h-[150px] focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`berryId,count
oran-berry,10
pecha-berry,5`,"aria-label":"CSV形式でのきのみ在庫データ"})]})}function Ie(r,s={}){const{onEscape:t,enabled:l=!0,returnFocusRef:a}=s,o=h.useRef(null);h.useEffect(()=>{if(!l||!r.current)return;o.current=document.activeElement;const i=()=>{if(!r.current)return[];const d=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(", ");return Array.from(r.current.querySelectorAll(d)).filter(x=>x.offsetParent!==null&&window.getComputedStyle(x).visibility!=="hidden"&&window.getComputedStyle(x).display!=="none")},n=i();n.length>0&&n[0].focus();const c=d=>{if(d.key==="Escape"&&t){d.preventDefault(),t();return}if(d.key==="Tab"){const f=i();if(f.length===0){d.preventDefault();return}const x=f[0],y=f[f.length-1];d.shiftKey?document.activeElement===x&&(d.preventDefault(),y.focus()):document.activeElement===y&&(d.preventDefault(),x.focus())}};return document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c),a?.current?a.current.focus():o.current&&o.current.focus()}},[r,l,t,a])}function Fe({isOpen:r,onClose:s,onConfirm:t,returnFocusRef:l}){const a=h.useRef(null),o=h.useId();return Ie(a,{enabled:r,onEscape:s,returnFocusRef:l}),r?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:s,children:e.jsxs("div",{ref:a,className:"bg-white rounded-lg p-6 max-w-md mx-4",onClick:i=>i.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":o,children:[e.jsx("h3",{id:o,className:"text-lg font-semibold mb-4",children:"確認"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"すべてのきのみ個数を0にリセットします。この操作は取り消せません。よろしいですか？"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 border border-gray-300 rounded hover:bg-gray-50 transition-colors",children:"キャンセル"}),e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors",children:"リセット"})]})]})}):null}function Ae({filteredBerries:r,berryStocks:s,onStockChange:t,onResetStocks:l,hyperFilter:a,onHyperFilterChange:o,searchText:i,onSearchTextChange:n}){const c=A(),[d,f]=h.useState([]),[x,y]=h.useState(""),[N,p]=h.useState(!1),[b,g]=h.useState(i),k=h.useRef(null);h.useEffect(()=>{g(i)},[i]);const R=()=>{y(Me(s))},E=()=>{const u=Te(x),m=Object.keys(s);for(const T of m)t(T,0);for(const[T,D]of Object.entries(u))t(T,D)},V=()=>{l(),p(!1)},j=h.useMemo(()=>[{id:"stock",header:"個数",cell:u=>{const m=u.row.original;return e.jsx(Ve,{berry:m,value:s[m.id]||0,onChange:t})}},{accessorKey:"name",header:"Name",cell:u=>u.getValue()},{accessorKey:"id",header:"ID",cell:u=>e.jsx("span",{className:"text-gray-500",children:u.getValue()})},{accessorKey:"level",header:"レベル",cell:u=>u.getValue()},{accessorKey:"calories",header:"カロリー",cell:u=>u.getValue()},{accessorKey:"flavors.sweet",header:"スイート",cell:u=>{const m=u.row.original.flavors.sweet;return e.jsx("span",{className:`inline-block px-2 py-1 rounded ${m>0?"bg-pink-50":""}`,children:m})}},{accessorKey:"flavors.spicy",header:"スパイシー",cell:u=>{const m=u.row.original.flavors.spicy;return e.jsx("span",{className:`inline-block px-2 py-1 rounded ${m>0?"bg-red-50":""}`,children:m})}},{accessorKey:"flavors.sour",header:"サワー",cell:u=>{const m=u.row.original.flavors.sour;return e.jsx("span",{className:`inline-block px-2 py-1 rounded ${m>0?"bg-yellow-50":""}`,children:m})}},{accessorKey:"flavors.bitter",header:"ビター",cell:u=>{const m=u.row.original.flavors.bitter;return e.jsx("span",{className:`inline-block px-2 py-1 rounded ${m>0?"bg-blue-50":""}`,children:m})}},{accessorKey:"flavors.fresh",header:"フレッシュ",cell:u=>{const m=u.row.original.flavors.fresh;return e.jsx("span",{className:`inline-block px-2 py-1 rounded ${m>0?"bg-green-50":""}`,children:m})}},{accessorKey:"hyper",header:"異次元",cell:u=>u.getValue()?"✔︎":""}],[t,s]),M=U({data:r,columns:j,state:{sorting:d},onSortingChange:f,getCoreRowModel:_(),getSortedRowModel:q()});return e.jsxs("section",{className:"space-y-4",role:"tabpanel",id:"berries-panel","aria-labelledby":"berries-tab",children:[e.jsx(De,{onResetClick:()=>p(!0),resetButtonRef:k}),e.jsx(ze,{hyperFilter:a,onHyperFilterChange:o,searchText:b,onSearchTextChange:u=>{g(u),n(u)}}),c?e.jsx("div",{className:"space-y-3",children:r.map(u=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:u.name}),e.jsx("p",{className:"text-xs text-gray-500",children:u.id})]}),u.hyper&&e.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:"異次元"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm mb-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Sweet:"}),e.jsx("span",{className:"font-medium",children:u.flavors.sweet})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Spicy:"}),e.jsx("span",{className:"font-medium",children:u.flavors.spicy})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Sour:"}),e.jsx("span",{className:"font-medium",children:u.flavors.sour})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bitter:"}),e.jsx("span",{className:"font-medium",children:u.flavors.bitter})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Fresh:"}),e.jsx("span",{className:"font-medium",children:u.flavors.fresh})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"カロリー:"}),e.jsx("span",{className:"font-medium",children:u.calories})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"レベル:"}),e.jsx("span",{className:"font-medium",children:u.level})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[e.jsx("label",{htmlFor:`stock-${u.id}`,className:"text-sm font-medium text-gray-700",children:"個数:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>t(u.id,Math.max(0,(s[u.id]||0)-1)),className:"w-10 h-10 flex items-center justify-center bg-gray-100 hover:bg-gray-200 active:bg-gray-300 rounded-lg font-bold text-gray-700 transition-colors","aria-label":`${u.name}の個数を減らす`,children:"−"}),e.jsx("input",{id:`stock-${u.id}`,type:"number",min:"0",value:s[u.id]||0,onChange:m=>t(u.id,parseInt(m.target.value,10)||0),className:"border rounded px-3 py-2 w-16 text-center","aria-label":`${u.name}の個数`}),e.jsx("button",{type:"button",onClick:()=>t(u.id,(s[u.id]||0)+1),className:"w-10 h-10 flex items-center justify-center bg-blue-500 hover:bg-blue-600 active:bg-blue-700 rounded-lg font-bold text-white transition-colors","aria-label":`${u.name}の個数を増やす`,children:"＋"})]})]})]},u.id))}):e.jsx("div",{className:"overflow-x-auto border rounded",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("caption",{className:"sr-only",children:"きのみ在庫入力テーブル"}),e.jsx("thead",{className:"bg-gray-50",children:M.getHeaderGroups().map(u=>e.jsx("tr",{children:u.headers.map(m=>e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100",onClick:m.column.getToggleSortingHandler(),children:e.jsxs("div",{className:"flex items-center gap-1",children:[m.isPlaceholder?null:z(m.column.columnDef.header,m.getContext()),{asc:" ↑",desc:" ↓"}[m.column.getIsSorted()]??null]})},m.id))},u.id))}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:M.getRowModel().rows.map(u=>e.jsx("tr",{className:"hover:bg-gray-50",children:u.getVisibleCells().map(m=>e.jsx("td",{className:"px-4 py-2 text-sm",children:z(m.column.columnDef.cell,m.getContext())},m.id))},u.id))})]})}),e.jsx(Be,{csvText:x,onCsvTextChange:y,onExport:R,onImport:E}),e.jsx(Fe,{isOpen:N,onClose:()=>p(!1),onConfirm:V,returnFocusRef:k})]})}function Pe(){return h.useMemo(()=>{const r=new Map;for(const[s,t]of B.entries())r.set(t.name,s);return r},[])}function Oe(r){const s=Pe();return h.useMemo(()=>[...r].sort((t,l)=>{const a=s.get(t.donutName)??999,o=s.get(l.donutName)??999;return a!==o?a-o:t.recipeIndex-l.recipeIndex}),[r,s])}function Ke(r){return{handleDownloadCSV:h.useCallback(()=>{const t=Le(r),l=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);$e(t,`pokemon-za-recipes-${l}.csv`)},[r])}}function We({hasResults:r,onDownloadCSV:s}){return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"レシピ検索結果"}),r&&e.jsxs("button",{type:"button",onClick:s,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors flex items-center gap-2",title:"レシピをCSVファイルとしてダウンロード",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:[e.jsx("title",{children:"ダウンロード"}),e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})]}),"CSVダウンロード"]})]})}function Ue({resultCount:r,searchTime:s,isSearching:t=!1}){return t?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"font-medium",children:"計算中..."})]}):r===0||s===null||s===void 0?null:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:r.toLocaleString()})," 件の結果を",e.jsxs("span",{className:"font-medium",children:[" ",s.toFixed(3)]})," 秒で計算しました"]})}function _e({conditions:r,hasResults:s}){return!r||!s?null:e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-sm",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"検索条件"}),e.jsxs("div",{className:"space-y-1 text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"選択ドーナツ:"})," ",r.selectedDonuts.join("、")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"スロット数:"})," ",r.slots]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"使用可能きのみ:"})," ",r.berryCount,"種類"]})]})]})}function He({hasSelectedDonuts:r}){return e.jsx("p",{className:"text-gray-500",children:r?"選択されたドーナツに対して、条件を満たすレシピが見つかりませんでした。":"ドーナツ選択タブでドーナツを選択し、レシピを検索してください。"})}function Ye(){return h.useMemo(()=>[{accessorKey:"donutName",header:"ドーナツ",cell:r=>r.getValue(),meta:{width:"150px"}},{accessorKey:"recipeIndex",header:"レシピ#",cell:r=>r.getValue(),meta:{width:"80px"}},{accessorKey:"berries",header:"使用きのみ",cell:r=>e.jsx("div",{className:"text-sm whitespace-normal break-words",children:r.getValue()}),meta:{width:"350px"}},{accessorKey:"berryCount",header:"きのみ個数",cell:r=>r.getValue(),meta:{width:"100px"}},{accessorKey:"stars",header:"星",cell:r=>{const s=r.getValue();return s>0?"★".repeat(s):"-"},meta:{width:"100px"}},{accessorKey:"plusLevel",header:"プラスレベル",cell:r=>r.getValue(),meta:{width:"120px"}},{accessorKey:"donutEnergy",header:"ハラモチエネルギー",cell:r=>r.getValue(),meta:{width:"150px"}},{accessorKey:"sweet",header:"スイート",cell:r=>r.getValue(),meta:{width:"100px"}},{accessorKey:"spicy",header:"スパイシー",cell:r=>r.getValue(),meta:{width:"100px"}},{accessorKey:"sour",header:"サワー",cell:r=>r.getValue(),meta:{width:"100px"}},{accessorKey:"bitter",header:"ビター",cell:r=>r.getValue(),meta:{width:"100px"}},{accessorKey:"fresh",header:"フレッシュ",cell:r=>r.getValue(),meta:{width:"100px"}},{accessorKey:"totalLevel",header:"合計レベル",cell:r=>r.getValue(),meta:{width:"120px"}},{accessorKey:"totalCalories",header:"合計カロリー",cell:r=>r.getValue(),meta:{width:"120px"}}],[])}function Ge(r,s){const[t,l]=h.useState([]),a=h.useRef(null),o=U({data:r,columns:s,state:{sorting:t},onSortingChange:l,getCoreRowModel:_(),getSortedRowModel:q()}),i=o.getRowModel().rows,n=ee({count:i.length,getScrollElement:()=>a.current,estimateSize:()=>53,measureElement:c=>c.getBoundingClientRect().height,overscan:10});return{table:o,sortedRows:i,virtualizer:n,tableContainerRef:a}}function Je({recipes:r}){const s=Ye(),{table:t,sortedRows:l,virtualizer:a,tableContainerRef:o}=Ge(r,s);return e.jsxs("div",{ref:o,className:"overflow-auto border rounded bg-white",style:{height:"600px"},children:[e.jsx("div",{className:"sticky top-0 z-10",children:t.getHeaderGroups().map(i=>e.jsx("div",{className:"flex min-w-max bg-gray-50 border-b border-gray-200",children:i.headers.map(n=>{const d=n.column.columnDef.meta?.width||"120px",f=n.column.getToggleSortingHandler();return e.jsx("button",{type:"button",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase cursor-pointer hover:bg-gray-100 flex-shrink-0",style:{width:d},onClick:f,children:e.jsxs("div",{className:"flex items-center gap-1",children:[n.isPlaceholder?null:z(n.column.columnDef.header,n.getContext()),{asc:" ↑",desc:" ↓"}[n.column.getIsSorted()]??null]})},n.id)})},i.id))}),e.jsx("div",{style:{height:`${a.getTotalSize()}px`,width:"100%",position:"relative"},children:a.getVirtualItems().map(i=>{const n=l[i.index];return e.jsx("div",{"data-index":i.index,ref:a.measureElement,className:"hover:bg-gray-50 border-b border-gray-200 flex min-w-max",style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${i.start}px)`},children:n.getVisibleCells().map(c=>{const f=c.column.columnDef.meta?.width||"120px";return e.jsx("div",{className:"px-4 py-3 text-sm flex-shrink-0",style:{width:f},children:z(c.column.columnDef.cell,c.getContext())},c.id)})},n.id)})})]})}function Xe(r){const s=h.useRef(null);return{virtualizer:ee({count:r.length,getScrollElement:()=>s.current,estimateSize:()=>280,measureElement:l=>l.getBoundingClientRect().height,overscan:5}),cardContainerRef:s}}function Qe({recipe:r}){return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900",children:r.donutName}),e.jsxs("p",{className:"text-sm text-gray-500",children:["レシピ #",r.recipeIndex]}),r.stars>0&&e.jsx("p",{className:"text-yellow-500 text-lg mt-1",children:"★".repeat(r.stars)})]}),e.jsxs("div",{className:"text-right text-gray-800",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-xs",children:"+Lv. "}),e.jsx("span",{className:"font-bold",children:r.plusLevel})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-sm font-medium",children:r.donutEnergy}),e.jsx("span",{className:"text-xs",children:" kcal"})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"使用きのみ:"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.berries}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["きのみ個数: ",r.berryCount,"個"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["合計カロリー: ",r.totalCalories,"kcal / 合計レベル: Lv.",r.totalLevel]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center p-2 bg-pink-50 rounded",children:[e.jsx("p",{className:"text-gray-600",children:"Sweet"}),e.jsx("p",{className:"font-medium",children:r.sweet})]}),e.jsxs("div",{className:"text-center p-2 bg-red-50 rounded",children:[e.jsx("p",{className:"text-gray-600",children:"Spicy"}),e.jsx("p",{className:"font-medium",children:r.spicy})]}),e.jsxs("div",{className:"text-center p-2 bg-yellow-50 rounded",children:[e.jsx("p",{className:"text-gray-600",children:"Sour"}),e.jsx("p",{className:"font-medium",children:r.sour})]}),e.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded",children:[e.jsx("p",{className:"text-gray-600",children:"Bitter"}),e.jsx("p",{className:"font-medium",children:r.bitter})]}),e.jsxs("div",{className:"text-center p-2 bg-green-50 rounded",children:[e.jsx("p",{className:"text-gray-600",children:"Fresh"}),e.jsx("p",{className:"font-medium",children:r.fresh})]})]})]})}function Ze({recipes:r}){const{virtualizer:s,cardContainerRef:t}=Xe(r);return e.jsx("div",{ref:t,className:"overflow-auto border rounded",style:{height:"600px"},children:e.jsx("div",{style:{height:`${s.getTotalSize()}px`,width:"100%",position:"relative"},children:s.getVirtualItems().map(l=>{const a=r[l.index];return e.jsx("div",{"data-index":l.index,ref:s.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${l.start}px)`},className:"px-3 py-1.5",children:e.jsx(Qe,{recipe:a})},l.key)})})})}function qe({recipeRows:r,searchConditions:s,searchTime:t,isSearching:l=!1}){const a=A(),o=Oe(r),{handleDownloadCSV:i}=Ke(o);return e.jsxs("section",{className:"space-y-4",role:"tabpanel",id:"results-panel","aria-labelledby":"results-tab",children:[e.jsx(We,{hasResults:o.length>0,onDownloadCSV:i}),e.jsx(Ue,{resultCount:o.length,searchTime:t,isSearching:l}),e.jsx(_e,{conditions:s,hasResults:o.length>0}),l?null:o.length===0?e.jsx(He,{hasSelectedDonuts:s!==void 0&&s.selectedDonuts.length>0}):a?e.jsx(Ze,{recipes:o}):e.jsx(Je,{recipes:o})]})}function er({disabled:r,isLoading:s,onClick:t,onCancel:l}){const a=A(),o=()=>s?"クリックでキャンセル":r?"ドーナツを選択してください":"レシピを検索",i=()=>{s&&l?l():t()};return e.jsx("button",{type:"button",onClick:i,disabled:r&&!s,className:`fixed ${a?"bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 rounded-full min-w-[200px]":"bottom-8 right-8 p-4 rounded-full"} ${s?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600"} text-white shadow-lg active:scale-95 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all z-50 flex items-center justify-center gap-2`,title:o(),"aria-label":o(),children:s?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6","aria-hidden":"true",children:[e.jsx("title",{children:"キャンセル"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})]}),a&&e.jsx("span",{className:"font-medium",children:"キャンセル"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6","aria-hidden":"true",children:[e.jsx("title",{children:"検索"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})]}),a&&e.jsx("span",{className:"font-medium",children:"レシピを検索"})]})})}function Z({message:r,variant:s="error",onClose:t,duration:l=5e3}){h.useEffect(()=>{if(l>0){const i=setTimeout(()=>{t()},l);return()=>clearTimeout(i)}},[l,t]);const a={error:"bg-red-500 text-white",success:"bg-green-500 text-white",info:"bg-blue-500 text-white"},o={error:e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("title",{children:"エラー"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),success:e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("title",{children:"成功"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]}),info:e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("title",{children:"情報"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]})};return e.jsxs("div",{className:`fixed bottom-24 right-8 max-w-md p-4 rounded-lg shadow-lg flex items-start gap-3 z-50 animate-slide-up ${a[s]}`,role:"alert","aria-live":"assertive",children:[e.jsx("div",{className:"flex-shrink-0",children:o[s]}),e.jsx("div",{className:"flex-1 text-sm whitespace-pre-line",children:r}),e.jsx("button",{type:"button",onClick:t,className:"flex-shrink-0 hover:opacity-80 transition-opacity","aria-label":"閉じる",children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("title",{children:"閉じる"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})]})})]})}function lr(){const r=Y.useNavigate(),s=Y.useSearch(),t=s.tab,l=h.useCallback(v=>{r({search:S=>({...S,hyperFilter:v})})},[r]),a=h.useCallback(v=>{r({search:S=>({...S,search:v})})},[r]),o=h.useCallback(v=>{r({search:S=>({...S,slots:v})})},[r]),{filteredBerries:i,hyperFilter:n,setHyperFilter:c,searchText:d,setSearchText:f}=ae({hyperFilter:s.hyperFilter,searchText:s.search,setHyperFilter:l,setSearchText:a}),{berryStocks:x,handleStockChange:y,handleResetStocks:N}=ne(),{selectedDonuts:p,handleDonutToggle:b,slots:g}=ce(s.slots,o),{recipeRows:k,handleFindRecipes:R,cancelSearch:E,isSearching:V,error:j,clearError:M,warning:u,clearWarning:m,searchTime:T}=je(),D=h.useCallback(v=>{r({search:S=>({...S,tab:v})})},[r]),w=h.useCallback(async()=>{try{await R(p,x,g),r({search:v=>({...v,tab:"results"})})}catch{}},[R,p,x,g,r]),L=h.useMemo(()=>{if(p.size===0)return;const v=Array.from(p).map(P=>B.find(te=>te.id===P)?.name).filter(Boolean),S=Object.values(x).filter(P=>P>0).length;return{selectedDonuts:v,slots:g,berryCount:S}},[p,g,x]);return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx(Ne,{activeTab:t,onTabChange:D}),t==="donuts"&&e.jsx(Re,{selectedDonuts:p,onDonutToggle:b,slots:g,onSlotsChange:o}),t==="berries"&&e.jsx(Ae,{filteredBerries:i,berryStocks:x,onStockChange:y,onResetStocks:N,hyperFilter:n,onHyperFilterChange:c,searchText:d,onSearchTextChange:f}),t==="results"&&e.jsx(qe,{recipeRows:k,searchConditions:L,searchTime:T,isSearching:V}),e.jsx(er,{disabled:p.size===0,isLoading:V,onClick:w,onCancel:E}),p.size===0&&t!=="donuts"&&e.jsxs("div",{className:"fixed bottom-24 right-8 bg-yellow-50 border border-yellow-300 rounded-lg p-4 shadow-lg max-w-xs z-40",children:[e.jsx("p",{className:"text-sm text-yellow-900 mb-2 font-medium",children:"ドーナツが未選択です"}),e.jsx("p",{className:"text-xs text-yellow-800 mb-3",children:"レシピを検索するには、まずドーナツを選択してください"}),e.jsx("button",{type:"button",onClick:()=>D("donuts"),className:"w-full bg-yellow-500 text-white px-3 py-2 rounded text-sm hover:bg-yellow-600 transition-colors",children:"ドーナツ選択タブへ →"})]}),j&&e.jsx(Z,{message:j,variant:"error",onClose:M}),u&&e.jsx(Z,{message:u,variant:"info",onClose:m})]})}export{lr as component};
